<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate - NGO Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div class="max-w-xl mx-auto py-12 px-4">
        <div class="bg-white shadow-xl rounded-2xl p-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Support Our Cause</h1>
            <p class="text-gray-600 mb-8">Your contribution helps us provide clean water to rural areas.</p>

            <form id="donationForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-3">Select Amount (LKR)</label>
                    <div class="grid grid-cols-3 gap-3">
                        <button type="button" onclick="setAmount(1000)" class="amt-btn border-2 border-blue-500 py-2 rounded-lg text-blue-600 font-semibold hover:bg-blue-50 transition">1,000</button>
                        <button type="button" onclick="setAmount(5000)" class="amt-btn border-2 border-gray-200 py-2 rounded-lg text-gray-600 font-semibold hover:border-blue-50 transition">5,000</button>
                        <button type="button" onclick="setAmount(10000)" class="amt-btn border-2 border-gray-200 py-2 rounded-lg text-gray-600 font-semibold hover:border-blue-50 transition">10,000</button>
                    </div>
                    <input type="number" id="amount" name="amount" placeholder="Custom Amount" class="mt-4 block w-full border-gray-300 rounded-md shadow-sm p-3 border focus:ring-blue-500 focus:border-blue-500" required>
                </div>

                <div class="grid grid-cols-1 gap-4">
                    <input type="text" id="first_name" placeholder="First Name" class="p-3 border rounded-md" required>
                    <input type="email" id="email" placeholder="Email Address" class="p-3 border rounded-md" required>
                    <input type="tel" id="phone" placeholder="Phone Number" class="p-3 border rounded-md" required>
                </div>

                <button type="submit" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl hover:bg-blue-700 transition transform active:scale-95">
                    Donate Now
                </button>
            </form>
        </div>
    </div>

    <form id="payhereRedirectForm" method="post" action="https://sandbox.payhere.lk/pay/checkout">
        <div id="hiddenFields"></div>
    </form>

    <script>
        function setAmount(val) {
            document.getElementById('amount').value = val;
        }

        document.getElementById('donationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // 1. Collect Data
            const donationData = {
                amount: document.getElementById('amount').value,
                firstName: document.getElementById('first_name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value
            };

            // 2. Call Backend to get Hash & OrderID
            const response = await fetch('http://localhost:5000/api/donations/initiate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(donationData)
            });

            const data = await response.json();

            if (data.success) {
                // 3. Inject PayHere params and Submit
                const container = document.getElementById('hiddenFields');
                Object.keys(data.params).forEach(key => {
                    container.innerHTML += `<input type="hidden" name="${key}" value="${data.params[key]}">`;
                });
                document.getElementById('payhereRedirectForm').submit();
            }
        });
    </script>
</body>
</html>